{% doc %}
  @prompt
    Generate a Shopify section in Liquid that allows me to upload a video or embed a link, with full width and no padding. Include a schema setting that lets me choose 'Show on mobile only', 'Show on desktop only', or 'Show on all devices'. Based on this selection, the section should output a CSS class that hides it accordingly. Also add a custom CSS class setting.

{% enddoc %}
{% assign ai_gen_id = section.id | replace: '_', '' | downcase %}

{% style %}
  .ai-video-section-{{ ai_gen_id }} {
    width: 100%;
    margin: 0;
    padding: 0;
  }

  .ai-video-section-{{ ai_gen_id }}.hide-mobile {
    display: block;
  }

  .ai-video-section-{{ ai_gen_id }}.hide-desktop {
    display: none;
  }

  .ai-video-section-{{ ai_gen_id }}.show-all {
    display: block;
  }

  .ai-video-section__container-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%;
    overflow: hidden;
  }

  .ai-video-section__video-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-video-section__iframe-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }

  .ai-video-section__placeholder-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-video-section__placeholder-{{ ai_gen_id }} svg {
    width: 100px;
    height: 100px;
    opacity: 0.5;
  }

  @media screen and (max-width: 749px) {
    .ai-video-section-{{ ai_gen_id }}.hide-mobile {
      display: none;
    }

    .ai-video-section-{{ ai_gen_id }}.hide-desktop {
      display: block;
    }
  }
{% endstyle %}

{% liquid
  case section.settings.device_visibility
    when 'mobile_only'
      assign visibility_class = 'hide-desktop'
    when 'desktop_only'
      assign visibility_class = 'hide-mobile'
    else
      assign visibility_class = 'show-all'
  endcase

  if section.settings.custom_css_class != blank
    assign custom_class = ' ' | append: section.settings.custom_css_class
  else
    assign custom_class = ''
  endif
%}

<div
  class="ai-video-section-{{ ai_gen_id }} {{ visibility_class }}{{ custom_class }}"
  {{ section.shopify_attributes }}
>
  <div class="ai-video-section__container-{{ ai_gen_id }}">
    {% if section.settings.video_file != blank %}
      <video
        class="ai-video-section__video-{{ ai_gen_id }}"
        {% if section.settings.autoplay %}autoplay{% endif %}
        {% if section.settings.loop %}loop{% endif %}
        {% if section.settings.muted %}muted{% endif %}
        {% if section.settings.controls %}controls{% endif %}
        playsinline
        preload="metadata"
      >
        <source src="{{ section.settings.video_file }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    {% elsif section.settings.video_url != blank %}
      {% liquid
        assign video_id = ''
        assign video_type = ''
        
        if section.settings.video_url contains 'youtube.com/watch'
          assign video_id = section.settings.video_url | split: 'v=' | last | split: '&' | first
          assign video_type = 'youtube'
        elsif section.settings.video_url contains 'youtu.be/'
          assign video_id = section.settings.video_url | split: 'youtu.be/' | last | split: '?' | first
          assign video_type = 'youtube'
        elsif section.settings.video_url contains 'vimeo.com/'
          assign video_id = section.settings.video_url | split: 'vimeo.com/' | last | split: '?' | first
          assign video_type = 'vimeo'
        endif%}

      {% if video_type == 'youtube' and video_id != blank %}
        <iframe
          class="ai-video-section__iframe-{{ ai_gen_id }}"
          src="https://www.youtube.com/embed/{{ video_id }}?autoplay={{ section.settings.autoplay | default: 0 }}&loop={{ section.settings.loop | default: 0 }}&mute={{ section.settings.muted | default: 0 }}&controls={{ section.settings.controls | default: 1 }}&rel=0&modestbranding=1"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"
        ></iframe>
      {% elsif video_type == 'vimeo' and video_id != blank %}
        <iframe
          class="ai-video-section__iframe-{{ ai_gen_id }}"
          src="https://player.vimeo.com/video/{{ video_id }}?autoplay={{ section.settings.autoplay | default: 0 }}&loop={{ section.settings.loop | default: 0 }}&muted={{ section.settings.muted | default: 0 }}&controls={{ section.settings.controls | default: 1 }}"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          loading="lazy"
        ></iframe>
      {% else %}
        <div class="ai-video-section__placeholder-{{ ai_gen_id }}">
          {{ 'image' | placeholder_svg_tag }}
        </div>
      {% endif %}
    {% else %}
      <div class="ai-video-section__placeholder-{{ ai_gen_id }}">
        {{ 'image' | placeholder_svg_tag }}
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Video Section",
  "settings": [
    {
      "type": "header",
      "content": "Video Source"
    },
    {
      "type": "video",
      "id": "video_file",
      "label": "Video file",
      "info": "Upload a video file (MP4 recommended)"
    },
    {
      "type": "url",
      "id": "video_url",
      "label": "Video URL",
      "info": "YouTube or Vimeo URL (used if no video file is uploaded)"
    },
    {
      "type": "header",
      "content": "Video Settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": false,
      "info": "Video will play automatically when page loads"
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop",
      "default": false,
      "info": "Video will repeat continuously"
    },
    {
      "type": "checkbox",
      "id": "muted",
      "label": "Muted",
      "default": true,
      "info": "Video will start without sound"
    },
    {
      "type": "checkbox",
      "id": "controls",
      "label": "Show controls",
      "default": true,
      "info": "Display video player controls"
    },
    {
      "type": "header",
      "content": "Visibility"
    },
    {
      "type": "select",
      "id": "device_visibility",
      "label": "Show on",
      "options": [
        {
          "value": "all_devices",
          "label": "All devices"
        },
        {
          "value": "desktop_only",
          "label": "Desktop only"
        },
        {
          "value": "mobile_only",
          "label": "Mobile only"
        }
      ],
      "default": "all_devices"
    },
    {
      "type": "header",
      "content": "Advanced"
    },
    {
      "type": "text",
      "id": "custom_css_class",
      "label": "Custom CSS class",
      "info": "Add custom CSS classes separated by spaces"
    }
  ],
  "presets": [
    {
      "name": "Video Section"
    }
  ]
}
{% endschema %}